<ul class="space-y-3">
    {% for entry in nodes %}
        <li class="border-l pl-4">
            <div class="space-y-2">
                <div class="flex flex-wrap items-baseline gap-2">
                    <span class="font-semibold text-gray-900">{{ entry.node.title }}</span>
                    <span class="text-xs uppercase tracking-wide text-gray-500">{{ entry.node.identifier }}</span>
                </div>
                <div class="text-xs text-gray-600">
                    Tag: <code class="font-mono bg-gray-100 px-1 rounded">{{ entry.node.tag_value }}</code>
                </div>
                {% if entry.node.definition %}
                    <p class="text-sm text-gray-700">{{ entry.node.definition }}</p>
                {% endif %}
                {% if entry.node.guidance %}
                    <p class="text-xs text-indigo-700 bg-indigo-50 border border-indigo-100 rounded p-2">Guidance: {{ entry.node.guidance }}</p>
                {% endif %}
                {% if entry.node.sources %}
                    <div class="text-xs text-gray-600">
                        <span class="font-semibold">Sources:</span>
                        <ul class="list-disc pl-4">
                            {% for source in entry.node.sources %}
                                {% if source.label or source.url %}
                                    <li>
                                        {% if source.url %}
                                            <a href="{{ source.url }}" class="text-indigo-600 hover:underline" target="_blank" rel="noopener">
                                                {{ source.label|default:source.url }}
                                            </a>
                                        {% else %}
                                            {{ source.label }}
                                        {% endif %}
                                    </li>
                                {% else %}
                                    <li>{{ source }}</li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                {% if entry.metadata_json %}
                    <details class="text-xs text-gray-500">
                        <summary class="cursor-pointer">Metadata</summary>
                        <pre class="mt-1 bg-gray-50 p-2 rounded font-mono whitespace-pre-wrap">{{ entry.metadata_json }}</pre>
                    </details>
                {% endif %}
            </div>
            {% if entry.children %}
                <div class="mt-3">
                    {% include "core/knowledge_maps/partials/node_tree.html" with nodes=entry.children %}
                </div>
            {% endif %}
        </li>
    {% endfor %}
</ul>
