{% extends "base.html" %}
{% block title %}Knowledge Maps Â· Corvus{% endblock %}
{% block content %}
<div class="flex flex-col gap-6 lg:flex-row">
    <section class="flex-1 space-y-4">
        <div class="bg-white shadow rounded p-4">
            <h1 class="text-2xl font-semibold mb-1">Knowledge Maps</h1>
            <p class="text-sm text-gray-600">
                Centralise the frameworks that describe your knowledge. Import a JSON map, then tag cards with <code class="font-mono text-xs px-1 bg-gray-100 rounded">km:&lt;map&gt;:&lt;node&gt;</code> to anchor every fact.
            </p>
        </div>
        {% if maps %}
            <div class="space-y-4">
                {% for map in maps %}
                    <article class="bg-white shadow rounded p-4 flex flex-col gap-3">
                        <div class="flex items-start justify-between gap-4 flex-wrap">
                            <div>
                                <h2 class="text-xl font-semibold">{{ map.name }}</h2>
                                <p class="text-xs uppercase tracking-wide text-gray-500">Slug: {{ map.slug }}</p>
                            </div>
                            <div class="text-right text-sm text-gray-600">
                                <div>Nodes: {{ map.node_count }}</div>
                                <div>Tag prefix: <code class="font-mono text-xs bg-gray-100 px-1 rounded">km:{{ map.slug }}:</code></div>
                            </div>
                        </div>
                        {% if map.description %}
                            <p class="text-sm text-gray-700">{{ map.description }}</p>
                        {% endif %}
                        <div class="flex justify-end">
                            <a href="{% url 'knowledge_maps:detail' map.slug %}" class="inline-flex items-center px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-50">
                                View structure
                            </a>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-white border border-dashed rounded p-6 text-center text-sm text-gray-600">
                No knowledge maps yet. Use the import form to create one from JSON.
            </div>
        {% endif %}
    </section>
    <aside class="w-full lg:w-1/3 bg-white shadow rounded p-4 h-fit">
        <h2 class="text-lg font-semibold mb-3">Import knowledge map</h2>
        <p class="text-sm text-gray-600 mb-3">
            Upload a JSON file (e.g. generated by an AI) or paste JSON directly. Each import replaces the previous version of the map that shares the same slug.
        </p>
        <form method="post" enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="rounded border border-red-200 bg-red-50 text-red-700 text-sm p-3">
                    {{ form.non_field_errors|join:", " }}
                </div>
            {% endif %}
            <div class="space-y-1">
                <label class="text-sm font-medium">{{ form.json_file.label }}</label>
                {{ form.json_file }}
                {% if form.json_file.errors %}
                    <p class="text-xs text-red-600">{{ form.json_file.errors|join:", " }}</p>
                {% else %}
                    <p class="text-xs text-gray-500">{{ form.json_file.help_text }}</p>
                {% endif %}
            </div>
            <div class="space-y-1">
                <label class="text-sm font-medium">{{ form.json_text.label }}</label>
                {{ form.json_text }}
                {% if form.json_text.errors %}
                    <p class="text-xs text-red-600">{{ form.json_text.errors|join:", " }}</p>
                {% else %}
                    <p class="text-xs text-gray-500">{{ form.json_text.help_text }}</p>
                {% endif %}
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded text-sm font-semibold hover:bg-indigo-500">
                Import knowledge map
            </button>
            <p class="text-xs text-gray-500">
                Need an example? Check <code class="font-mono">samples/knowledge_map.json</code> in the repo.
            </p>
        </form>
    </aside>
</div>
{% endblock %}
