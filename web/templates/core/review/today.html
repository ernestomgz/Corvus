{% extends 'base.html' %}
{% block title %}Today | Corvus{% endblock %}
{% block content %}
<div class="mx-auto max-w-3xl space-y-6">
    <header class="flex flex-col gap-3 rounded border bg-white p-6 shadow md:flex-row md:items-center md:justify-between">
        <div>
            <h1 class="text-2xl font-semibold">Today</h1>
            <p class="text-sm text-gray-500">Track your due cards and start a session.</p>
        </div>
        <form method="get" class="flex flex-wrap items-center gap-3">
            <label for="deck" class="text-sm text-gray-600">Deck</label>
            <select name="deck_id" id="deck" class="rounded border border-gray-300 px-3 py-2">
                <option value="">All decks</option>
                {% for deck in decks %}
                    <option value="{{ deck.id }}" {% if active_deck and active_deck.id == deck.id %}selected{% endif %}>{{ deck.name }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">Apply</button>
        </form>
    </header>

    <section class="grid gap-4 rounded border bg-white p-6 text-center shadow md:grid-cols-3">
        <div>
            <h2 class="text-sm uppercase tracking-wide text-gray-500">New</h2>
            <p class="mt-2 text-3xl font-semibold text-indigo-600">{{ summary.new_count }}</p>
        </div>
        <div>
            <h2 class="text-sm uppercase tracking-wide text-gray-500">Review</h2>
            <p class="mt-2 text-3xl font-semibold text-indigo-600">{{ summary.review_count }}</p>
        </div>
        <div>
            <h2 class="text-sm uppercase tracking-wide text-gray-500">Due Now</h2>
            <p class="mt-2 text-3xl font-semibold text-red-500">{{ summary.due_count }}</p>
        </div>
    </section>

    <section class="rounded border bg-white p-6 shadow">
        <div id="review-panel" hx-get="{% url 'review:next' %}{% if active_deck %}?deck_id={{ active_deck.id }}{% endif %}" hx-trigger="load" hx-target="#review-panel" hx-swap="innerHTML">
            <div class="py-10 text-center text-gray-500">Loading...</div>
        </div>
    </section>
</div>

<script>
    document.addEventListener('keydown', function(event) {
        const keyMap = { 'a': 0, 'h': 1, 'g': 2, 'e': 3 };
        const rating = keyMap[event.key.toLowerCase()];
        if (rating !== undefined) {
            const button = document.querySelector(`[data-rating="${rating}"]`);
            if (button) {
                button.click();
            }
        }
    });
</script>
{% endblock %}
